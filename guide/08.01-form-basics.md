# Chapter 8.1: Form Basics

Before diving into Phoenix-specific form handling, let's review HTML form fundamentals and how they work in web applications.

## HTML Form Structure

```html
<form action="/snippets" method="post">
  <label for="title">Title</label>
  <input type="text" id="title" name="snippet[title]" value="">

  <label for="content">Content</label>
  <textarea id="content" name="snippet[content]"></textarea>

  <button type="submit">Create</button>
</form>
```

Key attributes:
- `action` - URL to submit to
- `method` - HTTP method (GET or POST)
- `name` - Parameter name sent to server

## HTTP Methods and Forms

HTML forms only support GET and POST. Phoenix uses method overriding for PUT/PATCH/DELETE:

```heex
<%# Phoenix generates a hidden field for method override %>
<form action="/snippets/123" method="post">
  <input type="hidden" name="_method" value="put">
  <!-- form fields -->
</form>
```

## Parameter Structure

### Flat Parameters

```html
<input name="title" value="My Snippet">
<input name="content" value="Code here">
```

Results in:
```elixir
%{"title" => "My Snippet", "content" => "Code here"}
```

### Nested Parameters

```html
<input name="snippet[title]" value="My Snippet">
<input name="snippet[content]" value="Code here">
```

Results in:
```elixir
%{"snippet" => %{"title" => "My Snippet", "content" => "Code here"}}
```

### Array Parameters

```html
<input name="snippet[tags][]" value="elixir">
<input name="snippet[tags][]" value="phoenix">
```

Results in:
```elixir
%{"snippet" => %{"tags" => ["elixir", "phoenix"]}}
```

## Input Types

### Text Inputs

```heex
<%# Single line text %>
<input type="text" name="snippet[title]">

<%# Password (masked) %>
<input type="password" name="user[password]">

<%# Email with validation %>
<input type="email" name="user[email]">

<%# URL with validation %>
<input type="url" name="snippet[source_url]">

<%# Number %>
<input type="number" name="snippet[expires_in]" min="1" max="365">

<%# Multi-line text %>
<textarea name="snippet[content]" rows="10"></textarea>
```

### Selection Inputs

```heex
<%# Dropdown %>
<select name="snippet[language]">
  <option value="">Select language...</option>
  <option value="elixir">Elixir</option>
  <option value="javascript">JavaScript</option>
  <option value="python">Python</option>
</select>

<%# Radio buttons %>
<input type="radio" name="snippet[visibility]" value="public" id="public">
<label for="public">Public</label>

<input type="radio" name="snippet[visibility]" value="private" id="private">
<label for="private">Private</label>

<%# Checkboxes %>
<input type="checkbox" name="snippet[featured]" value="true" id="featured">
<label for="featured">Featured</label>

<%# Multiple checkboxes %>
<input type="checkbox" name="snippet[tags][]" value="elixir" id="tag-elixir">
<label for="tag-elixir">Elixir</label>

<input type="checkbox" name="snippet[tags][]" value="phoenix" id="tag-phoenix">
<label for="tag-phoenix">Phoenix</label>
```

### Date and Time

```heex
<%# Date %>
<input type="date" name="snippet[expires_at]">

<%# Time %>
<input type="time" name="event[start_time]">

<%# Datetime %>
<input type="datetime-local" name="event[starts_at]">
```

### Hidden Fields

```heex
<%# Hidden data %>
<input type="hidden" name="snippet[user_id]" value="123">
<input type="hidden" name="return_to" value="/dashboard">
```

## Form in Controller

### Handling GET (Display Form)

```elixir
# File: lib/snippetbox_web/controllers/snippet_controller.ex

def new(conn, _params) do
  changeset = Snippets.change_snippet(%Snippet{})
  render(conn, :new, changeset: changeset)
end
```

### Handling POST (Process Form)

```elixir
def create(conn, %{"snippet" => snippet_params}) do
  case Snippets.create_snippet(snippet_params) do
    {:ok, snippet} ->
      conn
      |> put_flash(:info, "Snippet created successfully.")
      |> redirect(to: ~p"/snippets/#{snippet}")

    {:error, %Ecto.Changeset{} = changeset} ->
      render(conn, :new, changeset: changeset)
  end
end
```

## Request/Response Cycle

### GET /snippets/new

```
Browser                    Server
   |                         |
   |  GET /snippets/new      |
   |------------------------>|
   |                         |
   |                    Controller.new()
   |                         |
   |                    render(:new)
   |                         |
   |   HTML with empty form  |
   |<------------------------|
   |                         |
```

### POST /snippets

```
Browser                    Server
   |                         |
   | POST /snippets          |
   | {snippet: {...}}        |
   |------------------------>|
   |                         |
   |                    Controller.create()
   |                         |
   |                    Snippets.create_snippet()
   |                         |
   |                    {:ok, snippet}
   |                         |
   | 302 Redirect            |
   | Location: /snippets/1   |
   |<------------------------|
   |                         |
   | GET /snippets/1         |
   |------------------------>|
   |                         |
```

### POST with Validation Errors

```
Browser                    Server
   |                         |
   | POST /snippets          |
   | {snippet: {title: ""}}  |
   |------------------------>|
   |                         |
   |                    Controller.create()
   |                         |
   |                    Snippets.create_snippet()
   |                         |
   |                    {:error, changeset}
   |                         |
   | 200 OK                  |
   | HTML with form + errors |
   |<------------------------|
   |                         |
```

## Form Accessibility

### Labels

Always associate labels with inputs:

```heex
<%# Using for/id %>
<label for="snippet_title">Title</label>
<input type="text" id="snippet_title" name="snippet[title]">

<%# Or wrap the input %>
<label>
  Title
  <input type="text" name="snippet[title]">
</label>
```

### Required Fields

```heex
<label for="title">
  Title <span aria-hidden="true">*</span>
</label>
<input type="text" id="title" name="snippet[title]" required aria-required="true">
```

### Error Messages

```heex
<label for="title">Title</label>
<input type="text" id="title" name="snippet[title]"
  aria-invalid="true"
  aria-describedby="title-error">
<span id="title-error" role="alert">can't be blank</span>
```

> **FP Concept: Forms as Data Transformation**
>
> Form handling in Phoenix follows functional principles:
>
> ```elixir
> # Input: raw params from form
> %{"snippet" => %{"title" => "Hello"}}
>
> # Transform: build changeset
> changeset = Snippet.changeset(%Snippet{}, params)
>
> # Output: either success or error
> case Repo.insert(changeset) do
>   {:ok, snippet} -> # success path
>   {:error, changeset} -> # error path with reasons
> end
> ```
>
> Each step is a pure transformation, making the flow predictable and testable.

## Summary

In this chapter, we learned:

- HTML form structure and attributes
- HTTP methods and method overriding
- Parameter naming conventions (nested, arrays)
- Common input types
- Controller actions for forms
- The request/response cycle
- Accessibility best practices

In the next chapter, we'll explore Phoenix's form components.
