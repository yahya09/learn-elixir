# Chapter 17: Guided Exercises

These exercises will help you reinforce what you've learned and extend the SnippetBox application with new features. Each exercise includes hints and suggested approaches.

## Exercise 1: Add an About Page

**Difficulty**: Easy
**Time**: 15-20 minutes
**Concepts**: Routing, Controllers, Templates

### Task

Add an "About" page to the application that displays information about SnippetBox.

### Requirements

1. Create a route at `/about` that responds to GET requests
2. Create a controller action to handle the request
3. Create a template that displays:
   - Application name and version
   - Purpose/description
   - Contact information
4. Add a link to the About page in the navigation menu

### Hints

<details>
<summary>Click to show hints</summary>

1. Add a route in `router.ex`:
```elixir
get "/about", PageController, :about
```

2. Add an action in your controller:
```elixir
def about(conn, _params) do
  render(conn, :about)
end
```

3. Create the template file
4. Update your layout template to include a navigation link

</details>

### Extension

- Add the current date/time to the page using Elixir's `DateTime`
- Display application statistics (total snippets, total users)
- Make the content editable through an admin interface

---

## Exercise 2: Add a Debug Mode

**Difficulty**: Medium
**Time**: 30-40 minutes
**Concepts**: Configuration, Environment Variables, Plugs

### Task

Add a debug mode that displays extra information for development purposes.

### Requirements

1. Create a configuration option to enable/disable debug mode
2. When enabled, display:
   - Current environment (dev/test/prod)
   - Request parameters
   - Session data
   - Execution time for each request
3. Create a plug that adds debug information to assigns
4. Add a debug info section to the layout (only visible in debug mode)

### Hints

<details>
<summary>Click to show hints</summary>

1. Add configuration in `config/dev.exs`:
```elixir
config :snippetbox, debug_mode: true
```

2. Create a plug module:
```elixir
defmodule SnippetboxWeb.Plugs.Debug do
  import Plug.Conn
  import Phoenix.Controller

  def init(opts), do: opts

  def call(conn, _opts) do
    if Application.get_env(:snippetbox, :debug_mode) do
      conn
      |> assign(:debug_mode, true)
      |> assign(:debug_info, gather_debug_info(conn))
    else
      conn
    end
  end

  defp gather_debug_info(conn) do
    %{
      env: Mix.env(),
      params: conn.params,
      session: get_session(conn)
    }
  end
end
```

3. Add the plug to your router pipeline

</details>

### Extension

- Log all requests to a separate debug log file
- Create a `/debug` route that shows system metrics
- Add a toolbar that displays debug info without cluttering the page

---

## Exercise 3: Test the Snippet Creation

**Difficulty**: Medium
**Time**: 30-45 minutes
**Concepts**: Testing, ExUnit, Test Fixtures

### Task

Write comprehensive tests for the snippet creation functionality.

### Requirements

1. Test controller action:
   - Rendering the new snippet form
   - Creating a snippet with valid data
   - Rejecting invalid data
   - Requiring authentication
2. Test context function:
   - Creating a snippet
   - Validation rules
   - Associations with users
3. Test integration:
   - Full workflow from form to database

### Hints

<details>
<summary>Click to show hints</summary>

1. Controller test structure:
```elixir
defmodule SnippetboxWeb.SnippetControllerTest do
  use SnippetboxWeb.ConnCase

  describe "new snippet" do
    test "renders form", %{conn: conn} do
      conn = get(conn, ~p"/snippets/new")
      assert html_response(conn, 200) =~ "New Snippet"
    end

    test "requires authentication", %{conn: conn} do
      conn = get(conn, ~p"/snippets/new")
      assert redirected_to(conn) == ~p"/login"
    end
  end

  describe "create snippet" do
    setup [:create_user_and_log_in]

    test "creates snippet with valid data", %{conn: conn} do
      attrs = %{title: "Test", content: "Test content"}
      conn = post(conn, ~p"/snippets", snippet: attrs)
      assert redirected_to(conn) =~ ~p"/snippets/"
    end

    test "renders errors with invalid data", %{conn: conn} do
      conn = post(conn, ~p"/snippets", snippet: %{})
      assert html_response(conn, 200) =~ "can&#39;t be blank"
    end
  end
end
```

2. Context test structure:
```elixir
defmodule Snippetbox.SnippetsTest do
  use Snippetbox.DataCase

  alias Snippetbox.Snippets

  describe "create_snippet/2" do
    test "creates snippet with valid attributes" do
      user = insert(:user)
      attrs = %{title: "Test", content: "Test content"}

      assert {:ok, snippet} = Snippets.create_snippet(user, attrs)
      assert snippet.title == "Test"
      assert snippet.user_id == user.id
    end

    test "returns error changeset with invalid attributes" do
      user = insert(:user)
      assert {:error, %Ecto.Changeset{}} = Snippets.create_snippet(user, %{})
    end
  end
end
```

</details>

### Extension

- Add property-based tests using StreamData
- Test edge cases (very long content, special characters)
- Add performance tests for bulk operations

---

## Exercise 4: Add a User Profile Page

**Difficulty**: Medium
**Time**: 45-60 minutes
**Concepts**: Associations, Queries, Templates

### Task

Create a user profile page that displays information about a user and their snippets.

### Requirements

1. Create a route at `/users/:id`
2. Display:
   - Username and email
   - Join date
   - Total number of snippets created
   - List of user's public snippets (paginated)
   - User statistics (e.g., most popular snippet)
3. Add authorization (users can only edit their own profile)
4. Add a link to the profile from the navigation menu (when logged in)

### Hints

<details>
<summary>Click to show hints</summary>

1. Add route and controller action:
```elixir
# Router
get "/users/:id", UserController, :show

# Controller
def show(conn, %{"id" => id}) do
  user = Accounts.get_user!(id)
  snippets = Snippets.list_user_snippets(user, conn.params)
  render(conn, :show, user: user, snippets: snippets)
end
```

2. Add context function:
```elixir
def list_user_snippets(user, params) do
  Snippet
  |> where(user_id: ^user.id)
  |> order_by(desc: :inserted_at)
  |> Repo.paginate(params)
end

def user_stats(user) do
  %{
    total_snippets: count_user_snippets(user),
    total_views: sum_snippet_views(user),
    join_date: user.inserted_at
  }
end
```

</details>

### Extension

- Add ability to follow/unfollow users
- Create a feed of followed users' snippets
- Add user avatars with image uploads
- Implement user search functionality

---

## Exercise 5: Implement Snippet Expiration Handling

**Difficulty**: Medium-Hard
**Time**: 60-90 minutes
**Concepts**: DateTime, Background Jobs, Database Queries

### Task

Properly handle snippet expiration with automatic cleanup and visual indicators.

### Requirements

1. Add visual indicators for expiring soon (< 24 hours)
2. Automatically hide expired snippets from listings
3. Create a background job to delete expired snippets
4. Add warning when viewing snippets about to expire
5. Allow users to extend expiration date

### Hints

<details>
<summary>Click to show hints</summary>

1. Update queries to filter expired:
```elixir
def list_active_snippets(params) do
  now = DateTime.utc_now()

  Snippet
  |> where([s], is_nil(s.expires_at) or s.expires_at > ^now)
  |> order_by(desc: :inserted_at)
  |> Repo.paginate(params)
end
```

2. Add helper to check expiration status:
```elixir
def expiring_soon?(snippet) do
  case snippet.expires_at do
    nil -> false
    expires_at ->
      diff = DateTime.diff(expires_at, DateTime.utc_now())
      diff > 0 and diff < 86_400  # Less than 24 hours
  end
end
```

3. Create a Mix task for cleanup:
```elixir
defmodule Mix.Tasks.Snippetbox.CleanupExpired do
  use Mix.Task

  alias Snippetbox.Snippets

  @impl Mix.Task
  def run(_args) do
    Mix.Task.run("app.start")
    Snippets.delete_expired_snippets()
    Mix.shell().info("Expired snippets cleaned up")
  end
end
```

4. Schedule with Oban (optional):
```elixir
defmodule Snippetbox.Workers.CleanupExpiredSnippets do
  use Oban.Worker, queue: :default

  @impl Oban.Worker
  def perform(_job) do
    Snippetbox.Snippets.delete_expired_snippets()
    :ok
  end
end
```

</details>

### Extension

- Send email notifications before expiration
- Create a "recently expired" view for recovery
- Add analytics on expiration patterns
- Implement premium "never expires" option

---

## Exercise 6: Add Syntax Highlighting

**Difficulty**: Hard
**Time**: 90-120 minutes
**Concepts**: JavaScript Integration, LiveView, Libraries

### Task

Add syntax highlighting for code snippets with language detection.

### Requirements

1. Allow users to specify programming language when creating snippet
2. Automatically detect language if not specified
3. Display code with proper syntax highlighting
4. Add line numbers
5. Add "copy to clipboard" functionality

### Hints

<details>
<summary>Click to show hints</summary>

1. Add language field to schema:
```elixir
schema "snippets" do
  field :title, :string
  field :content, :string
  field :language, :string, default: "text"
  field :expires_at, :utc_datetime
  # ...
end
```

2. Use highlight.js or similar library:
```javascript
// app.js
import hljs from 'highlight.js';

document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('pre code').forEach((block) => {
    hljs.highlightElement(block);
  });
});
```

3. Template with syntax highlighting:
```eex
<pre><code class="language-<%= @snippet.language %>"><%= @snippet.content %></code></pre>
```

4. Add language selector in form:
```eex
<%= label f, :language %>
<%= select f, :language, [
  {"Plain Text", "text"},
  {"Elixir", "elixir"},
  {"Python", "python"},
  {"JavaScript", "javascript"},
  {"Ruby", "ruby"}
] %>
```

</details>

### Extension

- Implement automatic language detection using a library
- Add theme switcher (light/dark syntax themes)
- Integrate with LiveView for real-time preview
- Add code formatting/prettification option
- Support for code diffs

---

## Bonus Exercises

### Exercise 7: Add Snippet Tagging

Allow users to add tags to snippets for better organization and discovery.

**Features:**
- Add/remove tags to snippets
- Tag autocomplete
- Browse snippets by tag
- Tag cloud visualization
- Popular tags sidebar

### Exercise 8: Implement Full-Text Search

Add search functionality across all snippets.

**Features:**
- Search by title and content
- Search result highlighting
- Filter by language, date, author
- Search suggestions
- Search history

### Exercise 9: Add API Endpoints

Create a REST API for programmatic access.

**Features:**
- JWT authentication
- CRUD operations for snippets
- Rate limiting
- API documentation
- Versioning (v1, v2)

### Exercise 10: Real-time Collaboration

Allow multiple users to edit a snippet simultaneously using LiveView.

**Features:**
- Real-time cursor positions
- User presence indicators
- Conflict resolution
- Chat sidebar
- Version history with diffs

---

## Testing Your Solutions

For each exercise, ensure you:

1. **Write tests first** (TDD approach)
2. **Check edge cases** (empty inputs, invalid data)
3. **Test authentication** (logged in/out states)
4. **Verify authorization** (can users access what they should?)
5. **Test integration** (end-to-end workflows)

Example test checklist:

```elixir
# For each new feature:
☐ Unit tests for context functions
☐ Controller tests for each action
☐ Integration tests for workflows
☐ Edge cases and error handling
☐ Authorization checks
☐ Performance tests (if applicable)
```

## Getting Unstuck

If you're stuck on an exercise:

1. **Review relevant chapters** in this book
2. **Check the official docs** for Phoenix and Ecto
3. **Look at similar examples** in open-source projects
4. **Ask for help** on Elixir Forum
5. **Break the problem down** into smaller steps

Remember: Struggling is part of learning. Don't skip straight to solutions!

## Sharing Your Work

Once you complete an exercise:

1. **Push to GitHub** - Share your code
2. **Write a blog post** - Explain your approach
3. **Help others** - Answer questions on forums
4. **Iterate** - Improve based on feedback

## Next Steps

After completing these exercises, consider:

1. **Building your own project** - Apply all concepts
2. **Contributing to open source** - Help improve libraries
3. **Reading others' code** - Learn different approaches
4. **Teaching others** - Solidify your knowledge

Happy coding!
