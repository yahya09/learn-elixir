# Chapter 8.2: Phoenix Forms

Phoenix 1.7+ provides powerful form components that handle the complexity of form rendering. In this chapter, we'll explore Phoenix's form helpers and components.

## The Form Component

### Basic Form

```heex
<%# File: lib/snippetbox_web/controllers/snippet_html/new.html.heex %>

<.form for={@changeset} action={~p"/snippets"}>
  <.input field={@form[:title]} label="Title" />
  <.input field={@form[:content]} type="textarea" label="Content" />
  <.button>Create Snippet</.button>
</.form>
```

### Form With All Options

```heex
<.form
  for={@changeset}
  action={~p"/snippets/#{@snippet}"}
  method="put"
  multipart={true}
  class="space-y-4"
>
  <%# Form fields %>
</.form>
```

### Form Attributes

| Attribute | Description |
|-----------|-------------|
| `for` | Changeset or map for form data |
| `action` | URL to submit to |
| `method` | HTTP method (get, post, put, patch, delete) |
| `multipart` | Enable file uploads |
| `class` | CSS classes |
| `phx-change` | LiveView change event |
| `phx-submit` | LiveView submit event |

## The Input Component

### Default Input Component

Phoenix generates a default input component in `core_components.ex`:

```elixir
# File: lib/snippetbox_web/components/core_components.ex

attr :id, :any, default: nil
attr :name, :any
attr :label, :string, default: nil
attr :value, :any

attr :type, :string,
  default: "text",
  values: ~w(checkbox color date datetime-local email file hidden month number password
             range radio search select tel text textarea time url week)

attr :field, Phoenix.HTML.FormField
attr :errors, :list, default: []
attr :checked, :boolean
attr :prompt, :string, default: nil
attr :options, :list
attr :multiple, :boolean, default: false

attr :rest, :global,
  include: ~w(accept autocomplete capture cols disabled form list max maxlength min minlength
              multiple pattern placeholder readonly required rows size step)

slot :inner_block

def input(%{field: %Phoenix.HTML.FormField{} = field} = assigns) do
  assigns
  |> assign(field: nil, id: assigns.id || field.id)
  |> assign(:errors, Enum.map(field.errors, &translate_error(&1)))
  |> assign_new(:name, fn -> if assigns.multiple, do: field.name <> "[]", else: field.name end)
  |> assign_new(:value, fn -> field.value end)
  |> input()
end

def input(%{type: "textarea"} = assigns) do
  ~H"""
  <div phx-feedback-for={@name}>
    <.label for={@id}><%= @label %></.label>
    <textarea
      id={@id}
      name={@name}
      class={[
        "mt-2 block w-full rounded-lg text-zinc-900 focus:ring-0 sm:text-sm sm:leading-6",
        "min-h-[6rem] phx-no-feedback:border-zinc-300 phx-no-feedback:focus:border-zinc-400",
        @errors == [] && "border-zinc-300 focus:border-zinc-400",
        @errors != [] && "border-rose-400 focus:border-rose-400"
      ]}
      {@rest}
    ><%= Phoenix.HTML.Form.normalize_value("textarea", @value) %></textarea>
    <.error :for={msg <- @errors}><%= msg %></.error>
  </div>
  """
end

def input(%{type: "select"} = assigns) do
  ~H"""
  <div phx-feedback-for={@name}>
    <.label for={@id}><%= @label %></.label>
    <select
      id={@id}
      name={@name}
      class="mt-2 block w-full rounded-md border border-gray-300 bg-white shadow-sm focus:border-zinc-400 focus:ring-0 sm:text-sm"
      multiple={@multiple}
      {@rest}
    >
      <option :if={@prompt} value=""><%= @prompt %></option>
      <%= Phoenix.HTML.Form.options_for_select(@options, @value) %>
    </select>
    <.error :for={msg <- @errors}><%= msg %></.error>
  </div>
  """
end

# Default text input
def input(assigns) do
  ~H"""
  <div phx-feedback-for={@name}>
    <.label for={@id}><%= @label %></.label>
    <input
      type={@type}
      name={@name}
      id={@id}
      value={Phoenix.HTML.Form.normalize_value(@type, @value)}
      class={[
        "mt-2 block w-full rounded-lg text-zinc-900 focus:ring-0 sm:text-sm sm:leading-6",
        "phx-no-feedback:border-zinc-300 phx-no-feedback:focus:border-zinc-400",
        @errors == [] && "border-zinc-300 focus:border-zinc-400",
        @errors != [] && "border-rose-400 focus:border-rose-400"
      ]}
      {@rest}
    />
    <.error :for={msg <- @errors}><%= msg %></.error>
  </div>
  """
end
```

## Using Input Component

### Text Input

```heex
<.input field={@form[:title]} label="Title" />
<.input field={@form[:title]} label="Title" placeholder="Enter title..." />
<.input field={@form[:title]} label="Title" required />
```

### Textarea

```heex
<.input field={@form[:content]} type="textarea" label="Content" />
<.input field={@form[:content]} type="textarea" label="Content" rows={15} />
```

### Select

```heex
<%# Simple options %>
<.input
  field={@form[:language]}
  type="select"
  label="Language"
  options={["Elixir", "JavaScript", "Python", "Ruby"]}
/>

<%# With prompt %>
<.input
  field={@form[:language]}
  type="select"
  label="Language"
  prompt="Select a language..."
  options={["Elixir", "JavaScript", "Python", "Ruby"]}
/>

<%# Key-value options %>
<.input
  field={@form[:language]}
  type="select"
  label="Language"
  options={[
    {"Elixir", "elixir"},
    {"JavaScript", "javascript"},
    {"Python", "python"}
  ]}
/>

<%# From database %>
<.input
  field={@form[:category_id]}
  type="select"
  label="Category"
  options={Enum.map(@categories, &{&1.name, &1.id})}
/>
```

### Checkbox

```heex
<.input field={@form[:public]} type="checkbox" label="Make public" />
<.input field={@form[:featured]} type="checkbox" label="Featured snippet" />
```

### Radio Buttons

For radio buttons, create a custom component or use raw HTML:

```heex
<fieldset>
  <legend class="text-sm font-semibold">Visibility</legend>
  <div class="mt-2 space-y-2">
    <label class="flex items-center gap-2">
      <input type="radio" name={@form[:visibility].name} value="public"
        checked={@form[:visibility].value == "public"} />
      Public
    </label>
    <label class="flex items-center gap-2">
      <input type="radio" name={@form[:visibility].name} value="private"
        checked={@form[:visibility].value == "private"} />
      Private
    </label>
    <label class="flex items-center gap-2">
      <input type="radio" name={@form[:visibility].name} value="unlisted"
        checked={@form[:visibility].value == "unlisted"} />
      Unlisted
    </label>
  </div>
</fieldset>
```

### Hidden Fields

```heex
<.input field={@form[:user_id]} type="hidden" />
<input type="hidden" name="return_to" value={@return_to} />
```

### Password

```heex
<.input field={@form[:password]} type="password" label="Password" />
<.input field={@form[:password_confirmation]} type="password" label="Confirm Password" />
```

### Email and URL

```heex
<.input field={@form[:email]} type="email" label="Email" />
<.input field={@form[:website]} type="url" label="Website" />
```

### Number

```heex
<.input field={@form[:expires_in]} type="number" label="Expires in (days)" min="1" max="365" />
```

### Date and Time

```heex
<.input field={@form[:published_at]} type="date" label="Publish Date" />
<.input field={@form[:event_time]} type="time" label="Event Time" />
<.input field={@form[:starts_at]} type="datetime-local" label="Starts At" />
```

## Complete Form Example

```heex
<%# File: lib/snippetbox_web/controllers/snippet_html/new.html.heex %>

<.header>
  Create Snippet
  <:subtitle>Share your code with the world</:subtitle>
</.header>

<.form for={@changeset} action={~p"/snippets"} class="mt-8">
  <div class="space-y-6">
    <.input field={@form[:title]} label="Title" placeholder="My awesome snippet" required />

    <.input
      field={@form[:content]}
      type="textarea"
      label="Code"
      placeholder="Paste your code here..."
      rows={15}
      required
    />

    <.input
      field={@form[:language]}
      type="select"
      label="Language"
      prompt="Select language..."
      options={@languages}
    />

    <.input
      field={@form[:expires_in]}
      type="select"
      label="Expires"
      options={[
        {"Never", nil},
        {"1 hour", 1},
        {"1 day", 24},
        {"1 week", 168},
        {"1 month", 720}
      ]}
    />

    <.input field={@form[:public]} type="checkbox" label="Make this snippet public" />
  </div>

  <div class="mt-8 flex gap-4">
    <.button type="submit">Create Snippet</.button>
    <.link href={~p"/snippets"} class="btn-secondary">Cancel</.link>
  </div>
</.form>
```

## Edit Form

```heex
<%# File: lib/snippetbox_web/controllers/snippet_html/edit.html.heex %>

<.header>
  Edit Snippet
  <:subtitle>Update "<%= @snippet.title %>"</:subtitle>
</.header>

<.form for={@changeset} action={~p"/snippets/#{@snippet}"} method="put" class="mt-8">
  <div class="space-y-6">
    <.input field={@form[:title]} label="Title" required />
    <.input field={@form[:content]} type="textarea" label="Code" rows={15} required />
    <.input field={@form[:language]} type="select" label="Language" options={@languages} />
    <.input field={@form[:public]} type="checkbox" label="Make this snippet public" />
  </div>

  <div class="mt-8 flex gap-4">
    <.button type="submit">Update Snippet</.button>
    <.link href={~p"/snippets/#{@snippet}"} class="btn-secondary">Cancel</.link>
  </div>
</.form>

<div class="mt-8 border-t pt-8">
  <.link
    href={~p"/snippets/#{@snippet}"}
    method="delete"
    data-confirm="Are you sure you want to delete this snippet?"
    class="text-red-600 hover:text-red-800"
  >
    Delete this snippet
  </.link>
</div>
```

## Form Without Changeset

For forms not backed by a database:

```heex
<%# Search form %>
<.form for={%{}} action={~p"/search"} method="get">
  <.input name="q" value={@query} label="Search" placeholder="Search snippets..." />
  <.button>Search</.button>
</.form>

<%# Contact form %>
<.form for={%{}} action={~p"/contact"} method="post">
  <.input name="name" value="" label="Your Name" required />
  <.input name="email" type="email" value="" label="Email" required />
  <.input name="message" type="textarea" value="" label="Message" required />
  <.button>Send Message</.button>
</.form>
```

## Custom Form Components

### Input Group

```elixir
# File: lib/snippetbox_web/components/form_components.ex

defmodule SnippetboxWeb.FormComponents do
  use Phoenix.Component

  attr :class, :string, default: nil
  slot :inner_block, required: true

  def input_group(assigns) do
    ~H"""
    <div class={["flex gap-4", @class]}>
      <%= render_slot(@inner_block) %>
    </div>
    """
  end
end
```

Usage:

```heex
<.input_group>
  <.input field={@form[:first_name]} label="First Name" />
  <.input field={@form[:last_name]} label="Last Name" />
</.input_group>
```

### Submit Button Group

```elixir
attr :confirm_text, :string, default: "Save"
attr :cancel_url, :string, required: true

def submit_group(assigns) do
  ~H"""
  <div class="mt-8 flex gap-4">
    <.button type="submit"><%= @confirm_text %></.button>
    <.link href={@cancel_url} class="btn-secondary">Cancel</.link>
  </div>
  """
end
```

> **FP Concept: Declarative UI**
>
> Phoenix form components are declarative:
>
> ```heex
> <%# Declare WHAT you want, not HOW to render it %>
> <.input field={@form[:title]} type="text" label="Title" />
>
> <%# The component handles:
>     - Label rendering
>     - Input attributes
>     - Error display
>     - Accessibility
>     - Styling %>
> ```
>
> This separation of concerns keeps templates clean and behavior consistent.

## Summary

In this chapter, we learned:

- Using the `.form` component
- The `.input` component and its options
- Different input types (text, select, checkbox, etc.)
- Complete form examples for create and edit
- Forms without changesets
- Creating custom form components

In the next chapter, we'll explore how changesets integrate with forms.
