# Chapter 9: Sessions and State

HTTP is stateless, but web applications need to maintain state across requests. In this chapter, we'll explore how Phoenix manages sessions, flash messages, cookies, and caching.

## What You'll Learn

- Session management and configuration
- Flash messages for user feedback
- Working with cookies
- ETS for caching and state
- State management patterns

## Chapter Structure

This chapter covers:

- **9.1 Session Management** - Storing and retrieving session data
- **9.2 Flash Messages** - One-time user notifications
- **9.3 Cookies** - Client-side data storage
- **9.4 ETS and Caching** - In-memory state

## State in Web Applications

```
┌─────────────────────────────────────────────────────────┐
│                    State Options                         │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  Client-Side              Server-Side                    │
│  ┌──────────────┐         ┌──────────────┐              │
│  │   Cookies    │         │   Session    │              │
│  │              │         │   (in cookie │              │
│  │  - Small     │         │    or store) │              │
│  │  - Visible   │         │              │              │
│  │  - Unsigned  │         │  - Signed    │              │
│  └──────────────┘         │  - Encrypted │              │
│                           └──────────────┘              │
│  ┌──────────────┐         ┌──────────────┐              │
│  │ localStorage │         │     ETS      │              │
│  │              │         │              │              │
│  │  - Large     │         │  - Fast      │              │
│  │  - JS only   │         │  - In-memory │              │
│  └──────────────┘         │  - Per-node  │              │
│                           └──────────────┘              │
│                           ┌──────────────┐              │
│                           │   Database   │              │
│                           │              │              │
│                           │  - Persistent│              │
│                           │  - Shared    │              │
│                           └──────────────┘              │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

## When to Use What

| Storage | Use Case | Persistence | Size |
|---------|----------|-------------|------|
| Session | User authentication | Request-to-request | Small |
| Flash | One-time messages | Single redirect | Tiny |
| Cookies | Remember preferences | Configurable | 4KB max |
| ETS | Caching, rate limits | In-memory | Large |
| Database | User data, app state | Permanent | Unlimited |

## Phoenix Request Lifecycle with State

```
Request arrives
      ↓
Endpoint plugs
      ↓
┌─────────────────┐
│ :fetch_session  │ ← Load session from cookie/store
└─────────────────┘
      ↓
┌─────────────────┐
│ :fetch_flash    │ ← Load flash messages
└─────────────────┘
      ↓
Router & Controller
      ↓
┌─────────────────┐
│ Modify session  │ ← put_session, delete_session
│ Set flash       │ ← put_flash
└─────────────────┘
      ↓
Response sent
      ↓
Session saved to cookie/store
Flash cleared (after display)
```

Let's dive into session management.
