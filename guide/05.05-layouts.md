# Chapter 5.5: Layouts

Layouts provide the common structure for your pages - navigation, footer, and overall page skeleton. In this chapter, we'll create and customize layouts for Snippetbox.

## Understanding Layouts

Phoenix uses two-level layouts:

1. **Root Layout** (`root.html.heex`) - HTML skeleton, head, scripts
2. **App Layout** (`app.html.heex`) - Page structure, navigation

```
root.html.heex
├── <html>
├── <head>
├── <body>
│   └── app.html.heex
│       ├── <header>
│       ├── <main>
│       │   └── @inner_content (your page)
│       └── <footer>
```

## Root Layout

The outer HTML structure:

```heex
<%# File: lib/snippetbox_web/components/layouts/root.html.heex %>

<!DOCTYPE html>
<html lang="en" class="h-full">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="csrf-token" content={get_csrf_token()} />

    <title><%= assigns[:page_title] || "Snippetbox" %></title>
    <meta name="description" content={assigns[:page_description] || "Share code snippets"} />

    <%# Favicon %>
    <link rel="icon" type="image/x-icon" href={~p"/favicon.ico"} />

    <%# Stylesheets %>
    <link phx-track-static rel="stylesheet" href={~p"/assets/app.css"} />

    <%# Open Graph / Social %>
    <meta property="og:title" content={assigns[:page_title] || "Snippetbox"} />
    <meta property="og:description" content={assigns[:page_description] || "Share code snippets"} />
    <meta property="og:type" content="website" />

    <%# Scripts - deferred %>
    <script defer phx-track-static src={~p"/assets/app.js"}></script>
  </head>
  <body class="h-full bg-gray-50">
    <%= @inner_content %>
  </body>
</html>
```

## App Layout

The page structure with navigation:

```heex
<%# File: lib/snippetbox_web/components/layouts/app.html.heex %>

<div class="min-h-full flex flex-col">
  <header class="bg-white shadow-sm">
    <nav class="container mx-auto px-4">
      <div class="flex items-center justify-between h-16">
        <%# Logo %>
        <.link href={~p"/"} class="text-xl font-bold text-indigo-600">
          Snippetbox
        </.link>

        <%# Main navigation %>
        <div class="hidden md:flex items-center space-x-8">
          <.link href={~p"/snippets"} class="text-gray-600 hover:text-gray-900">
            Browse
          </.link>
          <.link href={~p"/snippets/new"} class="text-gray-600 hover:text-gray-900">
            Create
          </.link>
          <.link href={~p"/about"} class="text-gray-600 hover:text-gray-900">
            About
          </.link>
        </div>

        <%# User menu %>
        <div class="flex items-center space-x-4">
          <%= if @current_user do %>
            <span class="text-gray-600"><%= @current_user.email %></span>
            <.link href={~p"/logout"} method="delete" class="text-gray-600 hover:text-gray-900">
              Log out
            </.link>
          <% else %>
            <.link href={~p"/login"} class="text-gray-600 hover:text-gray-900">
              Log in
            </.link>
            <.link href={~p"/signup"} class="btn btn-primary">
              Sign up
            </.link>
          <% end %>
        </div>

        <%# Mobile menu button %>
        <button class="md:hidden" aria-label="Menu">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>
      </div>
    </nav>
  </header>

  <main class="flex-grow container mx-auto px-4 py-8">
    <%# Flash messages %>
    <.flash_group flash={@flash} />

    <%# Page content %>
    <%= @inner_content %>
  </main>

  <footer class="bg-white border-t">
    <div class="container mx-auto px-4 py-6">
      <div class="flex justify-between items-center">
        <p class="text-gray-500 text-sm">
          &copy; <%= DateTime.utc_now().year %> Snippetbox. All rights reserved.
        </p>
        <div class="space-x-4">
          <.link href={~p"/privacy"} class="text-gray-500 hover:text-gray-700 text-sm">
            Privacy
          </.link>
          <.link href={~p"/terms"} class="text-gray-500 hover:text-gray-700 text-sm">
            Terms
          </.link>
        </div>
      </div>
    </div>
  </footer>
</div>
```

## Flash Messages Component

```elixir
# File: lib/snippetbox_web/components/core_components.ex

def flash_group(assigns) do
  ~H"""
  <div class="flash-container">
    <.flash kind={:info} flash={@flash} />
    <.flash kind={:error} flash={@flash} />
  </div>
  """
end

attr :kind, :atom, required: true
attr :flash, :map, required: true

def flash(assigns) do
  ~H"""
  <%= if msg = Phoenix.Flash.get(@flash, @kind) do %>
    <div
      class={[
        "flash",
        @kind == :info && "flash-info",
        @kind == :error && "flash-error"
      ]}
      role="alert"
      phx-click="lv:clear-flash"
      phx-value-key={@kind}
    >
      <p><%= msg %></p>
      <button type="button" class="flash-close" aria-label="Close">
        &times;
      </button>
    </div>
  <% end %>
  """
end
```

## Multiple Layouts

### Auth Layout

For login/signup pages:

```heex
<%# File: lib/snippetbox_web/components/layouts/auth.html.heex %>

<div class="min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4">
  <div class="max-w-md w-full space-y-8">
    <div class="text-center">
      <.link href={~p"/"}>
        <h1 class="text-3xl font-bold text-indigo-600">Snippetbox</h1>
      </.link>
    </div>

    <.flash_group flash={@flash} />

    <div class="bg-white py-8 px-6 shadow rounded-lg">
      <%= @inner_content %>
    </div>

    <p class="text-center text-gray-500 text-sm">
      <.link href={~p"/"}>Back to home</.link>
    </p>
  </div>
</div>
```

### Bare Layout

For pages needing no layout:

```heex
<%# File: lib/snippetbox_web/components/layouts/bare.html.heex %>

<%= @inner_content %>
```

## Using Different Layouts

### In Controller

```elixir
def login(conn, _params) do
  conn
  |> put_layout(html: :auth)  # Use auth layout
  |> render(:login)
end

def embed(conn, %{"id" => id}) do
  snippet = Snippets.get_snippet!(id)

  conn
  |> put_layout(false)  # No layout
  |> put_root_layout(false)  # No root layout either
  |> render(:embed, snippet: snippet)
end
```

### In Router

```elixir
# File: lib/snippetbox_web/router.ex

pipeline :auth_layout do
  plug :put_layout, html: :auth
end

scope "/", SnippetboxWeb do
  pipe_through [:browser, :auth_layout]

  get "/login", SessionController, :new
  get "/signup", UserController, :new
end
```

## Setting Page Titles

### In Controller

```elixir
def show(conn, %{"id" => id}) do
  snippet = Snippets.get_snippet!(id)

  conn
  |> assign(:page_title, snippet.title)
  |> assign(:page_description, truncate(snippet.content, 160))
  |> render(:show, snippet: snippet)
end
```

### In Template

```heex
<%# At top of template %>
<.live_title suffix=" - Snippetbox">
  <%= @page_title || "Home" %>
</.live_title>
```

## Navigation Highlighting

### Active Link Component

```elixir
attr :href, :string, required: true
attr :current_path, :string, required: true
slot :inner_block, required: true

def nav_link(assigns) do
  active = assigns.current_path == assigns.href

  assigns = assign(assigns, :active, active)

  ~H"""
  <.link
    href={@href}
    class={[
      "nav-link",
      @active && "nav-link-active"
    ]}
  >
    <%= render_slot(@inner_block) %>
  </.link>
  """
end
```

### In Layout

```heex
<nav>
  <.nav_link href={~p"/snippets"} current_path={@conn.request_path}>
    Browse
  </.nav_link>
  <.nav_link href={~p"/snippets/new"} current_path={@conn.request_path}>
    Create
  </.nav_link>
</nav>
```

## Responsive Navigation

```heex
<header x-data="{ open: false }">
  <nav class="container mx-auto px-4">
    <div class="flex items-center justify-between h-16">
      <.link href={~p"/"} class="text-xl font-bold">Snippetbox</.link>

      <%# Desktop navigation %>
      <div class="hidden md:flex space-x-8">
        <.link href={~p"/snippets"}>Browse</.link>
        <.link href={~p"/snippets/new"}>Create</.link>
      </div>

      <%# Mobile menu button %>
      <button @click="open = !open" class="md:hidden">
        <svg x-show="!open" class="w-6 h-6"><!-- menu icon --></svg>
        <svg x-show="open" class="w-6 h-6"><!-- close icon --></svg>
      </button>
    </div>

    <%# Mobile navigation %>
    <div x-show="open" class="md:hidden py-4">
      <.link href={~p"/snippets"} class="block py-2">Browse</.link>
      <.link href={~p"/snippets/new"} class="block py-2">Create</.link>
    </div>
  </nav>
</header>
```

## Breadcrumbs

```elixir
attr :items, :list, required: true

def breadcrumbs(assigns) do
  ~H"""
  <nav aria-label="Breadcrumb" class="breadcrumbs">
    <ol>
      <%= for {label, path} <- Enum.intersperse(@items, :separator) do %>
        <%= if path == :separator do %>
          <li class="separator">/</li>
        <% else %>
          <li>
            <%= if path do %>
              <.link href={path}><%= label %></.link>
            <% else %>
              <span><%= label %></span>
            <% end %>
          </li>
        <% end %>
      <% end %>
    </ol>
  </nav>
  """
end
```

Usage:

```heex
<.breadcrumbs items={[
  {"Home", ~p"/"},
  {"Snippets", ~p"/snippets"},
  {@snippet.title, nil}
]} />
```

> **FP Concept: Layout as Higher-Order Function**
>
> Layouts are like higher-order functions - they take content and wrap it:
>
> ```
> layout(content) → wrapped_content
> root_layout(app_layout(page_content))
> ```
>
> This is function composition: each layout transforms its input and passes to the next.
>
> **Further Reading**:
> - [Phoenix Layouts](https://hexdocs.pm/phoenix/templates.html#layouts)

## Summary

In this chapter, we learned:

- Root and app layout structure
- Flash message handling
- Creating multiple layouts
- Setting page titles and metadata
- Navigation patterns
- Responsive design with layouts

In the next chapter, we'll explore view helpers and formatting functions.
