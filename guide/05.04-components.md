# Chapter 5.4: Phoenix Components

Phoenix components are reusable UI building blocks. In this chapter, we'll learn how to create and use function components to build a consistent, maintainable UI.

## What Are Components?

Components are functions that return HEEx markup:

```elixir
def button(assigns) do
  ~H"""
  <button class="btn"><%= @text %></button>
  """
end
```

Use them in templates:

```heex
<.button text="Click me" />
```

## Creating Components

### In Core Components

Phoenix provides a `core_components.ex` file:

```elixir
# File: lib/snippetbox_web/components/core_components.ex

defmodule SnippetboxWeb.CoreComponents do
  use Phoenix.Component

  # Simple button component
  attr :type, :string, default: "button"
  attr :class, :string, default: ""
  slot :inner_block, required: true

  def button(assigns) do
    ~H"""
    <button type={@type} class={["btn", @class]}>
      <%= render_slot(@inner_block) %>
    </button>
    """
  end
end
```

### Component Attributes

Define expected attributes with `attr`:

```elixir
attr :id, :string, required: true
attr :name, :string, required: true
attr :value, :string, default: ""
attr :type, :string, default: "text"
attr :placeholder, :string, default: nil
attr :class, :string, default: ""
attr :rest, :global

def input(assigns) do
  ~H"""
  <input
    type={@type}
    id={@id}
    name={@name}
    value={@value}
    placeholder={@placeholder}
    class={["form-input", @class]}
    {@rest}
  />
  """
end
```

### Slots

Slots allow passing content into components:

```elixir
slot :inner_block, required: true
slot :icon
slot :actions

def card(assigns) do
  ~H"""
  <div class="card">
    <%= if @icon do %>
      <div class="card-icon">
        <%= render_slot(@icon) %>
      </div>
    <% end %>

    <div class="card-content">
      <%= render_slot(@inner_block) %>
    </div>

    <%= if @actions do %>
      <div class="card-actions">
        <%= render_slot(@actions) %>
      </div>
    <% end %>
  </div>
  """
end
```

Usage:

```heex
<.card>
  <:icon>üìù</:icon>
  <h3>Card Title</h3>
  <p>Card content goes here.</p>
  <:actions>
    <.button>Save</.button>
  </:actions>
</.card>
```

## Common Component Patterns

### Button Component

```elixir
attr :type, :string, default: "button"
attr :variant, :string, default: "primary", values: ~w(primary secondary danger outline)
attr :size, :string, default: "md", values: ~w(sm md lg)
attr :disabled, :boolean, default: false
attr :class, :string, default: ""
attr :rest, :global

slot :inner_block, required: true

def button(assigns) do
  ~H"""
  <button
    type={@type}
    disabled={@disabled}
    class={[
      "btn",
      "btn-#{@variant}",
      "btn-#{@size}",
      @disabled && "btn-disabled",
      @class
    ]}
    {@rest}
  >
    <%= render_slot(@inner_block) %>
  </button>
  """
end
```

### Badge Component

```elixir
attr :variant, :string, default: "default", values: ~w(default success warning danger info)
attr :size, :string, default: "md"
slot :inner_block, required: true

def badge(assigns) do
  ~H"""
  <span class={["badge", "badge-#{@variant}", "badge-#{@size}"]}>
    <%= render_slot(@inner_block) %>
  </span>
  """
end
```

### Alert Component

```elixir
attr :type, :string, default: "info", values: ~w(info success warning error)
attr :dismissible, :boolean, default: false
slot :inner_block, required: true

def alert(assigns) do
  ~H"""
  <div class={["alert", "alert-#{@type}"]} role="alert">
    <div class="alert-content">
      <%= render_slot(@inner_block) %>
    </div>
    <%= if @dismissible do %>
      <button type="button" class="alert-dismiss" aria-label="Dismiss">
        &times;
      </button>
    <% end %>
  </div>
  """
end
```

### Form Input Component

```elixir
attr :field, Phoenix.HTML.FormField, required: true
attr :type, :string, default: "text"
attr :label, :string, default: nil
attr :class, :string, default: ""
attr :rest, :global

def form_input(assigns) do
  ~H"""
  <div class="form-group">
    <%= if @label do %>
      <label for={@field.id} class="form-label"><%= @label %></label>
    <% end %>

    <input
      type={@type}
      id={@field.id}
      name={@field.name}
      value={@field.value}
      class={["form-control", @field.errors != [] && "is-invalid", @class]}
      {@rest}
    />

    <%= for error <- @field.errors do %>
      <span class="invalid-feedback"><%= translate_error(error) %></span>
    <% end %>
  </div>
  """
end
```

### Modal Component

```elixir
attr :id, :string, required: true
attr :show, :boolean, default: false
attr :on_cancel, JS, default: %JS{}
slot :inner_block, required: true

def modal(assigns) do
  ~H"""
  <div
    id={@id}
    class={["modal", @show && "modal-open"]}
    phx-mounted={@show && show_modal(@id)}
  >
    <div class="modal-backdrop" phx-click={@on_cancel}></div>
    <div class="modal-content">
      <button class="modal-close" phx-click={@on_cancel}>&times;</button>
      <%= render_slot(@inner_block) %>
    </div>
  </div>
  """
end
```

## Snippet-Specific Components

### Snippet Card

```elixir
attr :snippet, :map, required: true
attr :show_author, :boolean, default: false

def snippet_card(assigns) do
  ~H"""
  <article class="snippet-card">
    <header>
      <h3>
        <.link href={~p"/snippets/#{@snippet}"}>
          <%= @snippet.title %>
        </.link>
      </h3>
      <.badge variant={language_variant(@snippet.language)}>
        <%= @snippet.language %>
      </.badge>
    </header>

    <div class="snippet-preview">
      <pre><code><%= truncate(@snippet.content, 150) %></code></pre>
    </div>

    <footer>
      <span class="time"><%= time_ago(@snippet.inserted_at) %></span>
      <%= if @show_author && @snippet.user do %>
        <span class="author">by <%= @snippet.user.name %></span>
      <% end %>
    </footer>
  </article>
  """
end

defp language_variant("elixir"), do: "info"
defp language_variant("ruby"), do: "danger"
defp language_variant("python"), do: "warning"
defp language_variant("javascript"), do: "success"
defp language_variant(_), do: "default"
```

### Snippet List

```elixir
attr :snippets, :list, required: true
attr :empty_message, :string, default: "No snippets found"

def snippet_list(assigns) do
  ~H"""
  <%= if Enum.empty?(@snippets) do %>
    <div class="empty-state">
      <p><%= @empty_message %></p>
    </div>
  <% else %>
    <div class="snippet-list">
      <%= for snippet <- @snippets do %>
        <.snippet_card snippet={snippet} />
      <% end %>
    </div>
  <% end %>
  """
end
```

### Code Block

```elixir
attr :code, :string, required: true
attr :language, :string, default: "text"
attr :show_line_numbers, :boolean, default: true

def code_block(assigns) do
  lines = String.split(assigns.code, "\n")
  assigns = assign(assigns, :lines, lines)

  ~H"""
  <div class="code-block">
    <div class="code-header">
      <span class="language"><%= @language %></span>
      <button class="copy-btn" data-code={@code}>Copy</button>
    </div>
    <pre><code class={"language-#{@language}"}><%= if @show_line_numbers do %><%= for {line, num} <- Enum.with_index(@lines, 1) do %><span class="line-number"><%= num %></span><%= line %>
<% end %><% else %><%= @code %><% end %></code></pre>
  </div>
  """
end
```

## Using Components

### Import in Templates

```elixir
# File: lib/snippetbox_web.ex

defp html_helpers do
  quote do
    import SnippetboxWeb.CoreComponents
    import SnippetboxWeb.SnippetComponents  # Custom components
  end
end
```

### In Templates

```heex
<.snippet_list snippets={@snippets} empty_message="Create your first snippet!" />

<.code_block code={@snippet.content} language={@snippet.language} />

<.button variant="primary" type="submit">
  Save Snippet
</.button>

<.alert type="success" dismissible>
  Snippet saved successfully!
</.alert>
```

## Component Documentation

```elixir
@doc """
Renders a button component.

## Examples

    <.button>Click me</.button>
    <.button variant="danger">Delete</.button>
    <.button type="submit" disabled={@submitting}>
      Save
    </.button>

## Attributes

- `type` - Button type (default: "button")
- `variant` - Visual style: primary, secondary, danger, outline
- `size` - Size: sm, md, lg
- `disabled` - Whether button is disabled

## Slots

- `inner_block` - Button content (required)
"""
attr :type, :string, default: "button"
# ...
def button(assigns) do
  # ...
end
```

> **FP Concept: Components as Pure Functions**
>
> Components are pure functions:
>
> ```elixir
> def button(assigns) ‚Üí HEEx
> ```
>
> Given the same assigns, they always return the same markup. This makes them:
> - **Predictable**: Same input = same output
> - **Testable**: Pass assigns, verify output
> - **Composable**: Build complex UIs from simple parts
>
> **Further Reading**:
> - [Phoenix.Component](https://hexdocs.pm/phoenix_live_view/Phoenix.Component.html)

## Summary

In this chapter, we learned:

- Creating function components
- Defining attributes with `attr`
- Using slots for content injection
- Building common UI components
- Domain-specific components
- Documenting components

In the next chapter, we'll explore layouts and page structure.
